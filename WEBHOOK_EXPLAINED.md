# üîó WEBHOOK_URL - –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ

## ü§ñ –ß—Ç–æ —Ç–∞–∫–æ–µ Webhook –≤ Telegram –±–æ—Ç–µ?

**Webhook** - —ç—Ç–æ URL-–∞–¥—Ä–µ—Å, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ –±–æ—Ç–∞.

### üì° –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ö–µ–º–∞:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Telegram ‚Üí –í–∞—à –±–æ—Ç (—á–µ—Ä–µ–∑ Webhook)
    ‚Üì              ‚Üì           ‚Üì
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç      –ü–æ–ª—É—á–∞–µ—Ç    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
—Å–æ–æ–±—â–µ–Ω–∏–µ       —Å–æ–æ–±—â–µ–Ω–∏–µ   –∏ –æ—Ç–≤–µ—á–∞–µ—Ç
   |              |           |
   ‚Üì              ‚Üì           ‚Üì
"/start"    ‚Üí  Telegram   ‚Üí  FastAPI
             —Å–µ—Ä–≤–µ—Ä—ã        –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                ‚Üì              ‚Üì
            POST –∑–∞–ø—Ä–æ—Å    –û–±—Ä–∞–±–æ—Ç—á–∏–∫
            –Ω–∞ webhook     –∫–æ–º–∞–Ω–¥—ã
```

## üîÑ –î–≤–∞ —Å–ø–æ—Å–æ–±–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π:

### **1. Polling (–æ–ø—Ä–æ—Å):**
```python
# –ë–æ—Ç —Å–∞–º —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É Telegram: "–ï—Å—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è?"
while True:
    updates = bot.get_updates()  # –ö–∞–∂–¥—ã–µ N —Å–µ–∫—É–Ω–¥
    process_updates(updates)
```
‚ùå –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### **2. Webhook (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π):**
```python
# Telegram —Å–∞–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä
@app.post("/webhook/BOT_TOKEN")
async def webhook(update: dict):
    process_update(update)  # –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ
```
‚úÖ –ë—ã—Å—Ç—Ä–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ

## üåê –û—Ç–∫—É–¥–∞ –±–µ—Ä–µ—Ç—Å—è WEBHOOK_URL?

### **–§–æ—Ä–º–∞—Ç URL:**
```
https://–≤–∞—à–µ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.koyeb.app/webhook/BOT_TOKEN
```

### **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `https://–≤–∞—à–µ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.koyeb.app` - –¥–æ–º–µ–Ω –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Koyeb
- `/webhook/` - –ø—É—Ç—å –¥–ª—è webhook (–Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ –∫–æ–¥–µ)
- `BOT_TOKEN` - —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üìã –ì–¥–µ –≤–∑—è—Ç—å –∫–∞–∂–¥—É—é —á–∞—Å—Ç—å:

### **1. –î–æ–º–µ–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–∞ Koyeb):**
- –°–æ–∑–¥–∞–µ—Ç–µ —Å–µ—Ä–≤–∏—Å –≤ Koyeb
- –ü–æ–ª—É—á–∞–µ—Ç–µ URL —Ç–∏–ø–∞: `https://padel-beer-bot-abc123.koyeb.app`
- –ò–ª–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç–µ –∫–∞—Å—Ç–æ–º–Ω—ã–π: `https://padel-beer-bot.koyeb.app`

### **2. –ü—É—Ç—å webhook (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ –∫–æ–¥–µ):**
```python
# –í app/main.py:
@app.post(settings.WEBHOOK_PATH)
async def webhook(request: Request):
    # settings.WEBHOOK_PATH = f"/webhook/{BOT_TOKEN}"
```

### **3. BOT_TOKEN (–æ—Ç @BotFather):**
- Telegram ‚Üí @BotFather ‚Üí /newbot
- –ü–æ–ª—É—á–∞–µ—Ç–µ —Ç–æ–∫–µ–Ω: `8494531608:AAGKfT5IIh8WehgsW-H04nG6pR1mQB_KD4o`

## üîß –ö–∞–∫ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ:

### **–í app/core/config.py:**
```python
class Settings:
    BOT_TOKEN: str = os.getenv("BOT_TOKEN", "")
    WEBHOOK_URL: str = os.getenv("WEBHOOK_URL", "")
    WEBHOOK_PATH: str = f"/webhook/{BOT_TOKEN}"
```

### **–í app/main.py:**
```python
@app.on_event("startup")
async def startup_event():
    if settings.WEBHOOK_URL:
        webhook_url = f"{settings.WEBHOOK_URL}{settings.WEBHOOK_PATH}"
        await telegram_app.bot.set_webhook(webhook_url)
        # Telegram –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —ç—Ç–æ—Ç URL
```

## üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä:

### **–í–∞—à–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
```env
BOT_TOKEN=8494531608:AAGKfT5IIh8WehgsW-H04nG6pR1mQB_KD4o
WEBHOOK_URL=https://padel-beer-bot.koyeb.app
```

### **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–ü–æ–ª–Ω—ã–π webhook URL: 
https://padel-beer-bot.koyeb.app/webhook/8494531608:AAGKfT5IIh8WehgsW-H04nG6pR1mQB_KD4o

Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —ç—Ç–æ—Ç –∞–¥—Ä–µ—Å
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

### **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –¢–æ–∫–µ–Ω –≤ URL –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –¢–æ–ª—å–∫–æ Telegram –∑–Ω–∞–µ—Ç –ø–æ–ª–Ω—ã–π URL
- HTTPS –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è webhook

### **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ webhook:**
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç webhook
- –ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å: `https://api.telegram.org/bot<TOKEN>/getWebhookInfo`

### **–û—Ç–ª–∞–¥–∫–∞:**
- –õ–æ–≥–∏ webhook –≤ Koyeb: `koyeb service logs padel-beer-bot`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook: `/webhook/...` –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å 200 OK

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

1. **–î–µ–ø–ª–æ–π –Ω–∞ Koyeb** ‚Üí –ø–æ–ª—É—á–∞–µ—Ç–µ –¥–æ–º–µ–Ω
2. **–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç–µ WEBHOOK_URL** –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. **–ë–æ—Ç —Å—Ç–∞—Ä—Ç—É–µ—Ç** ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç webhook –≤ Telegram
4. **–ì–æ—Ç–æ–≤–æ!** ‚Üí —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ API:**
```bash
curl https://padel-beer-bot.koyeb.app/
curl https://padel-beer-bot.koyeb.app/health
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ webhook (–ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è):**
```bash
curl https://api.telegram.org/bot8494531608:AAGKfT5IIh8WehgsW-H04nG6pR1mQB_KD4o/getWebhookInfo
```

–î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –≤–∞—à webhook URL –∏ —Å—Ç–∞—Ç—É—Å "OK".

## üì± –í Telegram –±–æ—Ç–µ:

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç `/start`:
1. Telegram –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –Ω–∞ –≤–∞—à webhook
3. FastAPI –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
4. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É
5. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

–í—Å–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ! ‚ö°
